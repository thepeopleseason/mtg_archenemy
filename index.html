<html>
<head>
<title>Archenemy</title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<link rel="icon" href="favicon.ico" type="image/x-icon">
<style type="text/css">
  .ongoingBtn {
    position: relative;
    bottom: 45px;
    cursor: pointer;
    opacity: 0.50;
  }
  .ongoingBtn:hover {
    opacity: 1.0;
  }
  .schemeDiv {
    height: 400px;
    width: 280px;
  }
  .schemeDiv img:hover, .ongoingBtn img:hover {
    transform: scale(1.5) translateY(20px);
  }
</style>
<script type="text/Javascript">
const schemes = [
  { name: "oarc-1-all-in-good-time.png", title: "All in Good Time", remote: false, },
  { name: "oarc-2-all-shall-smolder-in-my-wake.png", title: "All Shall Smolder in My Wake", },
  { name: "oarc-3-approach-my-molten-realm.png", title: "Approach My Molten Realm", },
  { name: "oarc-4-behold-the-power-of-destruction.png", title: "Behold the Power of Destruction", },
  { name: "oarc-5-choose-your-champion.png", title: "Choose Your Champion",},
  { name: "oarc-6-dance-pathetic-marionette.png", title: "Dance, Pathetic Marionette", remote: false, },
  { name: "oarc-7-the-dead-shall-serve.png", title: "The Dead Shall Serve", remote: false },
  { name: "oarc-8-a-display-of-my-dark-power.png", title: "A Display of My Dark Power", },
  { name: "oarc-9-embrace-my-diabolical-vision.png", title: "Embrace My Diabolical Vision", },
  { name: "oarc-10-every-hope-shall-vanish.png", title: "Every Hope Shall Vanish", },
  { name: "oarc-11-every-last-vestige-shall-rot.png", title: "Every Last Vestige Shall Rot", },
  { name: "oarc-12-evil-comes-to-fruition.png", title: "Evil Comes to Fruition", },
  { name: "oarc-13-the-fate-of-the-flammable.png", title: "The Fate of the Flammable", },
  { name: "oarc-14-feed-the-machine.png", title: "Feed the Machine", },
  { name: "oarc-15-i-bask-in-your-silent-awe.png", title: "I Bask in Your Silent Awe", ongoing: true, },
  { name: "oarc-16-i-call-on-the-ancient-magics.png", title: "I Call on the Ancient Magics", },
  { name: "oarc-17-i-delight-in-your-convulsions.png", title: "I Delight in Your Convulsions", },
  { name: "oarc-18-i-know-all-i-see-all.png", title: "I Know All, I See All", ongoing: true, },
  { name: "oarc-19-ignite-the-cloneforge.png", title: "Ignite the Cloneforge!", remote: false, },
  { name: "oarc-20-into-the-earthen-maw.png", title: "Into the Earthen Maw", },
  { name: "oarc-21-introductions-are-in-order.png", title: "Introductions Are in Order", },
  { name: "oarc-22-the-iron-guardian-stirs.png", title: "The Iron Guardian Stirs", },
  { name: "oarc-23-know-naught-but-fire.png", title: "Know Naught but Fire", },
  { name: "oarc-24-look-skyward-and-despair.png", title: "Look Skyward and Despair", },
  { name: "oarc-25-may-civilization-collapse.png", title: "May Civilization Collapse", },
  { name: "oarc-26-mortal-flesh-is-weak.png", title: "Mortal Flesh Is Weak", },
  { name: "oarc-27-my-crushing-masterstroke.png", title: "My Crushing Masterstroke", remote: false, },
  { name: "oarc-28-my-genius-knows-no-bounds.png", title: "My Genius Knows No Bounds", },
  { name: "oarc-29-my-undead-horde-awakens.png", title: "My Undead Horde Awakens", remote: false, ongoing: true, },
  { name: "oarc-30-my-wish-is-your-command.png", title: "My Wish Is Your Command", remote: false, },
  { name: "oarc-31-nature-demands-an-offering.png", title: "Nature Demands an Offering", },
  { name: "oarc-32-nature-shields-its-own.png", title: "Nature Shields Its Own", ongoing: true, },
  { name: "oarc-33-nothing-can-stop-me-now.png", title: "Nothing Can Stop Me Now", ongoing: true, },
  { name: "oarc-34-only-blood-ends-your-nightmares.png", title: "Only Blood Ends Your Nightmares", },
  { name: "oarc-35-the-pieces-are-coming-together.png", title: "The Pieces Are Coming Together", },
  { name: "oarc-36-realms-befitting-my-majesty.png", title: "Realms Befitting My Majesty", },
  { name: "oarc-37-roots-of-all-evil.png", title: "Roots of All Evil", },
  { name: "oarc-38-rotted-ones-lay-siege.png", title: "Rotted Ones, Lay Siege", },
  { name: "oarc-39-surrender-your-thoughts.png", title: "Surrender Your Thoughts", },
  { name: "oarc-40-tooth-claw-and-tail.png", title: "Tooth, Claw, and Tail", },
  { name: "oarc-41-the-very-soil-shall-shake.png", title: "The Very Soil Shall Shake", ongoing: true, },
  { name: "oarc-42-which-of-you-burns-brightest.png", title: "Which of You Burns Brightest?", },
  { name: "oarc-43-your-fate-is-thrice-sealed.png", title: "Your Fate Is Thrice Sealed", },
  { name: "oarc-44-your-puny-minds-cannot-fathom.png", title: "Your Puny Minds Cannot Fathom", },
  { name: "oarc-45-your-will-is-not-your-own.png", title: "Your Will Is Not Your Own", remote: false, },
  { name: "oe01-1-because-i-have-willed-it.png", title: "Because I Have Willed It", ongoing: true, },
  { name: "oe01-2-behold-my-grandeur.png", title: "Behold My Grandeur", remote: false, },
  { name: "oe01-3-bow-to-my-command.png", title: "Bow to My Command", ongoing: true, },
  { name: "oe01-4-choose-your-demise.png", title: "Choose Your Demise", },
  { name: "oe01-5-delight-in-the-hunt.png", title: "Delight in the Hunt", },
  { name: "oe01-6-every-dream-a-nightmare.png", title: "Every Dream a Nightmare", },
  { name: "oe01-7-for-each-of-you-a-gift.png", title: "For Each of You, a Gift", },
  { name: "oe01-8-know-evil.png", title: "Know Evil", },
  { name: "oe01-9-make-yourself-useful.png", title: "Make Yourself Useful", },
  { name: "oe01-10-the-mighty-will-fall.png", title: "The Mighty Will Fall", },
  { name: "oe01-11-my-forces-are-innumerable.png", title: "My Forces Are Innumerable", ongoing: true, },
  { name: "oe01-12-my-laughter-echoes.png", title: "My Laughter Echoes", ongoing: true, },
  { name: "oe01-13-no-one-will-hear-your-cries.png", title: "No One Will Hear Your Cries", },
  { name: "oe01-14-pay-tribute-to-me.png", title: "Pay Tribute to Me", },
  { name: "oe01-15-power-without-equal.png", title: "Power Without Equal", },
  { name: "oe01-16-a-reckoning-approaches.png", title: "A Reckoning Approaches", },
  { name: "oe01-17-there-is-no-refuge.png", title: "There Is No Refuge", },
  { name: "oe01-18-this-world-belongs-to-me.png", title: "This World Belongs to Me", },
  { name: "oe01-19-what-s-yours-is-now-mine.png", title: "What's Yours Is Now Mine", remote: false, },
  { name: "oe01-20-when-will-you-learn.png", title: "When Will You Learn?", remote: false, },
  { name: "parc-54-plots-that-span-centuries.png", title: "Plots That Span Centuries", remote: false, },
  { name: "parc-55-perhaps-you-ve-met-my-cohort.png", title: "Perhaps You've Met My Cohort?", },
  { name: "parc-56-your-inescapable-doom.png", title: "Your Inescapable Doom", ongoing: true, },
  { name: "parc-57-drench-the-soil-in-their-blood.png", title: "Drench the Soil in Their Blood", },
  { name: "parc-58-imprison-this-insolent-wretch.png", title: "Imprison This Insolent Wretch", ongoing: true, },
  { name: "dsc-328-behold-the-power-of-destruction.png", title: "Behold the Power of Destruction (DSC)" },
  { name: "dsc-329-chaos-is-my-plaything.png", title: "Chaos Is My Plaything" },
  { name: "dsc-330-choose-your-champion.png", title: "Choose Your Champion (DSC)" },
  { name: "dsc-331-choose-your-demise.png", title: "Choose Your Demise (DSC)" },
  { name: "dsc-332-dark-wings-bring-your-downfall.png", title: "Dark Wings Bring Your Downfall", ongoing: true },
  { name: "dsc-333-fear-my-authority.png", title: "Fear My Authority", ongoing: true },
  { name: "dsc-334-i-am-duskmourn.png", title: "I Am Duskmourn", ongoing: true },
  { name: "dsc-335-i-am-never-alone.png", title: "I Am Never Alone" },
  { name: "dsc-336-i-am-untouchable.png", title: "I Am Untouchable", ongoing: true },
  { name: "dsc-337-i-call-for-slaughter.png", title: "I Call for Slaughter", },
  { name: "dsc-338-i-will-savor-your-agony.png", title: "I Will Savor Your Agony", },
  { name: "dsc-339-kneel-before-my-legions.png", title: "Kneel Before My Legions" },
  { name: "dsc-340-mine-is-the-only-truth.png", title: "Mine Is the Only Truth", ongoing: true },
  { name: "dsc-341-my-champion-stands-supreme.png", title: "My Champion Stands Supreme", ongoing: true },
  { name: "dsc-342-my-crushing-masterstroke.png", title: "My Crushing Masterstroke (DSC)" },
  { name: "dsc-343-my-followers-ascend.png", title: "My Followers Ascend" },
  { name: "dsc-344-my-laughter-echoes.png", title: "My Laughter Echoes (DSC)", ongoing: true, },
  { name: "dsc-345-my-tendrils-run-deep.png", title: "My Tendrils Run Deep", ongoing: true, },
  { name: "dsc-346-my-wealth-will-bury-you.png", title: "My Wealth Will Bury You" },
  { name: "dsc-347-my-will-is-irresistible.png", title: "My Will Is Irresistible" },
  { name: "dsc-348-my-wings-enfold-all.png", title: "My Wings Enfold All" },
  { name: "dsc-349-no-secret-is-hidden-from-me.png", title: "No Secret Is Hidden from Me" },
  { name: "dsc-350-only-i-know-what-awaits.png", title: "Only I Know What Awaits" },
  { name: "dsc-351-plots-that-span-centuries.png", title: "Plots That Span Centuries (DSC)" },
  { name: "dsc-352-power-without-equal.png", title: "Power Without Equal (DSC)" },
  { name: "dsc-353-a-premonition-of-your-demise.png", title: "A Premonition of Your Demise" },
  { name: "dsc-354-reality-is-mine-to-control.png", title: "Reality Is Mine to Control", ongoing: true },
  { name: "dsc-355-rot-like-the-scum-you-are.png", title: "Rot Like the Scum You Are" },
  { name: "dsc-356-running-is-useless.png", title: "Running Is Useless" },
  { name: "dsc-357-time-bends-to-my-will.png", title: "Time Bends to My Will", },
  { name: "dsc-358-when-will-you-learn.png", title: "When Will You Learn? (DSC)", },
  { name: "dsc-359-you-are-unworthy-of-mercy.png", title: "You Are Unworthy of Mercy", },
  { name: "dsc-360-you-cannot-hide-from-me.png", title: "You Cannot Hide from Me" },
  { name: "dsc-361-you-exist-only-to-amuse.png", title: "You Exist Only to Amuse" },
  { name: "dsc-362-you-live-only-because-i-will-it.png", title: "You Live Only Because I Will It" },
  { name: "dsc-363-you-will-know-true-suffering.png", title: "You Will Know True Suffering" },
  { name: "dsc-364-your-mistake-is-my-triumph.png", title: "Your Mistake Is My Triumph" },
  { name: "dsc-365-your-nightmares-are-delicious.png", title: "Your Nightmares Are Delicious" },
  { name: "dsc-366-your-own-face-mocks-you.png", title: "Your Own Face Mocks You" },
  { name: "dsc-367-your-plans-mean-nothing.png", title: "Your Plans Mean Nothing" },
];

var deck;
var current;
var screenLock;
var oSchemes = [];
const urlParams = new URLSearchParams(window.location.search);

function set() {
  var scheme;

  if (current && !current.ongoing) {
    deck.push(current); // put it on the bottom
  }

  current = deck.shift(); // load new current
  if (!current.ongoing) {
    load(current);
  }
  else {
    oSchemes.push(current);
    unload();
    redraw();
  }
}

function clearScheme(schemeName) {
  oSchemes = oSchemes.filter(function(sch) {
    if (sch.name == schemeName) {
      deck.push(sch); // put it on the bottom
      return null;
    }
    else {
      return sch;
    }
  });
  redraw();
}

function redraw() {
  for (let i=0; i<12; i++) {
    if (i >= oSchemes.length) {
      var mydiv = document.getElementById("scheme" + (i+1));
      while(mydiv.firstChild) {
        mydiv.removeChild(mydiv.firstChild);
      }
    }
    else {
      load(oSchemes[i], "scheme" + (i+1));
    }
  }
}

function load(scheme, div = "scheme0") {
  document.getElementById(div).innerHTML = '<a href="#" onclick="set();"><img src="'
    + scheme.name + '" style="height: 100%;"></a>'
    + '<div id="' + div
    + 'Btn" class="ongoingBtn"><input type="button" value="Abandon" onclick="clearScheme(\''
    + scheme.name + '\')"></div>';
  if (!scheme.ongoing) {
    document.getElementById(div + 'Btn').style.display = "none";
  }
}

function unload() {
  document.getElementById('scheme0').innerHTML = '';
}

function preloader() {
  if (document.images) {
    for (let i in schemes) {
      var img = new Image();
      img.src = `${ schemes[i].name }`;
    }
  }
}

function generate_chooser() {
  let output = '<h1>Choose your schemes:</h1><form name="chooser_form" id="chooser_form">';
  saved_schemes = JSON.parse(localStorage.getItem('aeSchemes'));
  let scheck = '';
  if (saved_schemes) {
    if (saved_schemes.length == schemes.length) {
      scheck = 'checked';
    }
  } else {
    scheck = 'checked';
  }
  output += `<input id="selectall" type="checkbox" name="select" onclick="select_toggle()" ${ scheck }><em><label for="selectall">Select All/None</label></em><br />`
  sorted_schemes = schemes.sort((a, b) => (a.title < b.title) ? -1 : (a.title > b.title) ? 1 : 0)
  for (sch in sorted_schemes) {
    let checked = scheck || saved_schemes.includes(sorted_schemes[sch].name) ? 'checked' : '';
    output += `<input id="${ sorted_schemes[sch].name }" type="checkbox" name="chooser" value="${ sorted_schemes[sch].name }" ${checked}>`;
    output += `<a onmouseover="preview('${ sorted_schemes[sch].name }');"><label for="${ sorted_schemes[sch].name }">${ sorted_schemes[sch].title }</label></a><br />`;
  }
  output += '</form>';
  document.getElementById('chooser').innerHTML = output;
}

function init_deck() {
  checked = []
  for (i in document.chooser_form.chooser) {
    if (document.chooser_form.chooser[i].checked) {
      checked.push(document.chooser_form.chooser[i].value);
    }
  }
  deck = Array.from(schemes.filter(i => checked.includes(i.name)));
  localStorage.setItem('aeSchemes', JSON.stringify(deck.map(x => x.name)));

  // shuffle the deck
  for (let i=deck.length-1; i>0; i--) {
    const j = Math.floor(Math.random()*i)
    const temp = deck[i];
    deck[i] = deck[j];
    deck[j] = temp;
  }
}

async function init_game() {
  let count = 0;
  document.chooser_form.chooser.forEach(sch => sch.checked ? count++ : 0);
  if (count >= 20 || confirm("Archenemy scheme decks should contain at least 20 cards. I mean, you're the evil overlord, so I guess you can do what you want. Are you sure you wish to continue?")) {
    screenLock = await getScreenLock();
    init_deck();
    document.getElementById('start').style.display = "none";
    document.getElementById('preview').style.display = "none";
    document.getElementById('chooser').style.display = "none";
    document.getElementById('game').style.display = "block";
    set();
  }
}

async function getScreenLock() {
  if ('wakeLock' in navigator) {
    let screenLock;
    try {
      screenLock = await navigator.wakeLock.request('screen');
    } catch(err) {
      console.log(err.name, err.message);
    }
    return screenLock;
  }
}

function release() {
  if (typeof screenLock !== 'undefined' && screenLock != null) {
    screenLock.release().then(() => {
      console.log("screenLock released");
      screenLock = null;
    });
  }
}


function select_toggle() {
  document.chooser_form.chooser.forEach(i =>
    i.checked = document.chooser_form.select.checked);
}

function preview(sch) {
  document.getElementById('preview').innerHTML = `<img src="${ sch }" style="width: 30vw">`;
}

function start() {
  document.addEventListener('keydown', (function(e) {
    switch(e.which) {
    case 13:
      // ENTER: Set a new scheme in motion
      set();
      break;
    }
  }));
  generate_chooser();
  preloader();
}
</script>

<body style="text-align: center; overflow: auto; margin: 80px 90px 80px; " onload="start();">

<div id="start" style="top: 25; position: fixed;">
<input type="button" value="Start Archenemy!" id="start_button"
   onclick="init_game();" class="myButton">
</div>
<div id="preview" style="top: 100; position: fixed;"><img src="card-back-archenemy.jpg" style="width: 30vw"></div>
<div id="chooser" style="margin-left: 50vw; text-align: left;"></div>

<div id="game" style="display: none;">
<div class="schemeDiv" id="scheme0" style="float: left;"></div>
<div class="schemeDiv" id="scheme1" style="float: left;"></div>
<div class="schemeDiv" id="scheme2" style="float: left;"></div>
<div class="schemeDiv" id="scheme3" style="float: left;"></div>
<div class="schemeDiv" id="scheme4" style="float: left;"></div>
<div class="schemeDiv" id="scheme5" style="float: left;"></div>
<div class="schemeDiv" id="scheme6" style="float: left;"></div>
<div class="schemeDiv" id="scheme7" style="float: left;"></div>
<div class="schemeDiv" id="scheme8" style="float: left;"></div>
<div class="schemeDiv" id="scheme9" style="float: left;"></div>
<div class="schemeDiv" id="scheme10" style="float: left;"></div>
<div class="schemeDiv" id="scheme11" style="float: left;"></div>
<div class="schemeDiv" id="scheme12" style="float: left;"></div>
</div>

<div class="footer" style="position: fixed; text-align: center;
  font-size: 0.5vw; left: 0; bottom: 0; width: 100%; background-color: white;">
Unofficial Fan Content permitted under the Fan Content Policy. Not approved/endorsed by Wizards. Portions of the
materials used are property of <a href="https://magic.wizards.com/">Wizards of the Coast</a>. ©Wizards of the Coast LLC.</div>
</body>
</html>
